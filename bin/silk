#!/usr/bin/env lua

package.path = arg[0]:match("(.-)[^\\/]+$") .. "../?.lua;" .. package.path

local Doc = require "silk.document"
local quarg = require "quarg"

local format = table.remove(arg, 1)
local ok, render = pcall(require, "silk.output." .. format)
if not ok then
	error("no such silk output format: " .. format)
end

local opts = quarg:extract(arg)
local input = arg[1] and io.open(arg[1]) or io.stdin
local doc = Doc:new(opts):parse_file(input)
io.stdout:write(render(doc))
